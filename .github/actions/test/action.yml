name: test
description: 'runs a test matrix'
inputs:
  python-version:
    required: true
  django-version:
    required: true

runs:
  using: "composite"
  steps:
  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: ${{ inputs.python-version }}

  - name: Update pip
    shell: sh
    run: python -m pip install --upgrade pip

  - name: Install Django
    shell: sh
    run: python -m pip install "Django>=${{ inputs.django-version }},<${{ inputs.django-version }}.99"
    if: ${{ inputs.django-version != 'main' }}

  - name: Install Django main
    shell: sh
    run: python -m pip install https://github.com/django/django/archive/main.tar.gz
    if: ${{ inputs.django-version == 'main' }}

  - name: Install Django dependencies
    shell: sh
    run: pip install flake8 django-redis pymemcache

  - name: Test
    shell: sh
    run: |
      ./run.sh test
